{
  "$schema": "https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json",
  "name": "Friendly Interactive Shell (fish)",
  "scopeName": "source.shell.fish",
  "fileTypes": [
    "fish"
  ],
  "uuid": "73fe8880-b0d7-4073-8543-e923d65dad79",
  "firstLineMatch": "^#!.*\\b(fish)\\b",
  "foldingStartMarker": "(;|^)\\s*(begin|for|function|if|switch|while)\\b.*$",
  "foldingStopMarker": "(;|^)\\s*end\\b.*$",
  "patterns": [
    {
      "include": "#comment"
    },
    {
      "include": "#line-continuation"
    },
    {
      "name": "invalid.illegal.function-call.fish",
      "begin": "\\)|end",
      "end": "(?=[\\s);&|<>])"
    },
    {
      "name": "invalid.illegal.operator.fish",
      "match": "\\&"
    },
    {
      "begin": "(?=\\S)",
      "end": "(\\n)|(;)|(&)|(?=\\)|#|end)",
      "endCaptures": {
        "1": {
          "name": "meta.function-call.operator.control.newline.fish"
        },
        "2": {
          "name": "meta.function-call.operator.control.semicolon.fish keyword.operator.control.fish"
        },
        "3": {
          "name": "meta.function-call.operator.control.ampersand.fish keyword.operator.control.fish"
        }
      },
      "patterns": [
        {
          "include": "#pipeline"
        }
      ]
    }
  ],
  "repository": {
    "comment": {
      "patterns": [
        {
          "name": "comment.line.fish",
          "begin": "\\#",
          "beginCaptures": {
            "0": {
              "name": "punctuation.definition.comment.fish"
            }
          },
          "end": "\\n"
        }
      ]
    },
    "line-continuation": {
      "patterns": [
        {
          "begin": "(?=\\\\\\n)",
          "end": "(?=\\n)|^(?![\\s\\#\\\\])|\\s(?![\\s\\#])",
          "patterns": [
            {
              "name": "constant.character.escape.newline.fish",
              "match": "\\\\\\n"
            },
            {
              "include": "#comment"
            }
          ]
        }
      ]
    },
    "pipeline": {
      "patterns": [
        {
          "begin": "(?=(and|or)\\b(?!\\s*[\\n\\)#;-]))",
          "end": "(?=[\\n\\)#]|;|&(?![|>]))",
          "patterns": [
            {
              "begin": "(and|or)\\b(?!\\s*[\\n\\);-])",
              "beginCaptures": {
                "1": {
                  "name": "meta.function-call.name.fish keyword.operator.word.fish meta.string.unquoted.fish"
                }
              },
              "end": "(?![^\\n\\S]|\\&|\\\\\\n)",
              "patterns": [
                {
                  "include": "#separator-whitespace"
                },
                {
                  "name": "invalid.illegal.operator.fish",
                  "match": "\\&"
                },
                {
                  "include": "#line-continuation"
                }
              ]
            },
            {
              "include": "#pipeline"
            }
          ]
        },
        {
          "include": "#pipeline-segment"
        }
      ]
    },
    "pipeline-segment": {
      "patterns": [
        {
          "begin": "(?=[&|]|(?:[0-9]+)?(?:<|>>?)|\\^\\^?)",
          "end": "(?x)\n(?=\\n)\n|\n(?!\n  \\s*\n  (?:\n    [\\n);&|]\n  |\n    (?:[0-9]+)?(?:<|>>?)|\\^\\^?\n  )\n)",
          "patterns": [
            {
              "name": "invalid.illegal.operator.fish",
              "match": "(?:[&|]|(?:[0-9]+)?(?:<|>>?)|\\^\\^?)"
            }
          ]
        },
        {
          "name": "invalid.illegal.function-call.fish",
          "match": "(?:case|else|end)(?=[\\s);&|<>])"
        },
        {
          "begin": "(?=[^\\s#])",
          "end": "(?=[\\n)#;&])",
          "patterns": [
            {
              "begin": "(?x)\n(?!\n  \\s|\\#|(?:(?:[0-9]+)?(?:<|>>?)|\\^\\^?)?\\|\n)",
              "end": "(?x)\n(?=\\s*\n  (?:\n    [\\n)#;&]\n  |\n    (?:(?:[0-9]+)?(?:<|>>?)|\\^\\^?)?\\|\n  )\n)",
              "patterns": [
                {
                  "include": "#command-call-meta"
                },
                {
                  "include": "#command-call-standard"
                }
              ]
            },
            {
              "begin": "(?x)\n(?=\n  (?:(?:[0-9]+)?(?:<|>>?)|\\^\\^?)?\\|\n)",
              "end": "(?=[\\n)#;&])",
              "patterns": [
                {
                  "name": "invalid.illegal.operator.fish",
                  "match": "(?:(?:[0-9]+)?(?:<|>>?)|\\^\\^?)?\\|(?=\\s*(?:$|[\\n)#;&]))"
                },
                {
                  "begin": "(?:([0-9]+)?(<|>>?)|(\\^\\^?))?(\\|)",
                  "captures": {
                    "0": {
                      "name": "meta.function-call.operator.pipe.fish"
                    },
                    "1": {
                      "name": "constant.numeric.file-descriptor.fish"
                    },
                    "2": {
                      "name": "keyword.operator.pipe.redirect.fish"
                    },
                    "3": {
                      "name": "keyword.operator.pipe.redirect.fish"
                    },
                    "4": {
                      "name": "keyword.operator.pipe.fish"
                    }
                  },
                  "end": "(?=[\\n)#;&])",
                  "patterns": [
                    {
                      "name": "invalid.illegal.function-call.fish",
                      "match": "(and|or)\\b(?!\\s*[\\n;-])"
                    },
                    {
                      "include": "#separator-whitespace"
                    },
                    {
                      "include": "#line-continuation"
                    },
                    {
                      "include": "#pipeline-segment"
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    },
    "command-call-meta": {
      "patterns": [
        {
          "begin": "(?x)\n(builtin|command|exec)\\b\n(?!\\s*\n  (?:\n    [\\n)#;&|]\n  |\n    (?:[0-9]+)?(?:<|>>?)|\\^\\^?\n  |\n    -\n  )\n)",
          "beginCaptures": {
            "1": {
              "name": "meta.function-call.name.fish support.function.fish meta.string.unquoted.fish"
            }
          },
          "end": "(?x)\n(?=\\s*\n  (?:\n    [\\n)#;&]\n  |\n    (?:(?:[0-9]+)?(?:<|>>?)|\\^\\^?)?\\|\n  )\n)",
          "patterns": [
            {
              "include": "#separator-whitespace"
            },
            {
              "include": "#line-continuation"
            },
            {
              "include": "#command-call-standard"
            }
          ]
        },
        {
          "begin": "(?=(not)\\b(?!\\s*[\\n)#;-]))",
          "end": "(?=[\\n)#;&])",
          "patterns": [
            {
              "begin": "(not)\\b(?!\\s*[\\n);-])",
              "beginCaptures": {
                "1": {
                  "name": "meta.function-call.name.fish keyword.operator.word.fish meta.string.unquoted.fish"
                }
              },
              "end": "(?![^\\n\\S]|\\&|\\\\\\n)",
              "patterns": [
                {
                  "include": "#separator-whitespace"
                },
                {
                  "name": "invalid.illegal.function-call.fish",
                  "match": "\\&"
                },
                {
                  "include": "#line-continuation"
                }
              ]
            },
            {
              "include": "#pipeline"
            }
          ]
        }
      ]
    },
    "command-call-standard": {
      "patterns": [
        {
          "begin": "(?=\\S)",
          "end": "(?x)\n(?=\n  (?:\n    [\\n)#;&]\n  |\n    (?:(?:[0-9]+)?(?:<|>>?)|\\^\\^?)?\\|\n  )\n)",
          "patterns": [
            {
              "begin": "(?![\\s<>^%])",
              "end": "(?=[\\s);&|<>])",
              "patterns": [
                {
                  "include": "#command-call-standard-block"
                },
                {
                  "begin": "\\[(?=[\\s<>]|\\\\\\n)",
                  "beginCaptures": {
                    "0": {
                      "name": "meta.function-call.name.fish support.function.test.begin.fish"
                    }
                  },
                  "end": "(\\])|(\\n|[;&)|].*)",
                  "endCaptures": {
                    "1": {
                      "name": "meta.function-call.name.fish support.function.test.end.fish"
                    },
                    "2": {
                      "name": "invalid.illegal.function-call.fish"
                    }
                  },
                  "patterns": [
                    {
                      "include": "#separator-whitespace"
                    },
                    {
                      "include": "#line-continuation"
                    },
                    {
                      "include": "#parameter"
                    },
                    {
                      "include": "#redirection"
                    }
                  ]
                },
                {
                  "match": "(?:break|continue|return)(?=[\\s);&|<>])",
                  "captures": {
                    "0": {
                      "name": "meta.function-call.name.fish keyword.control.conditional.fish meta.string.unquoted.fish"
                    }
                  }
                },
                {
                  "begin": "(?!\\s)",
                  "end": "(?=[\\s);&|<>])",
                  "patterns": [
                    {
                      "name": "invalid.illegal.function-call.fish",
                      "begin": "(?=\\()",
                      "end": "(?=[\\s);&|<>])",
                      "patterns": [
                        {
                          "begin": "\\(",
                          "end": "\\)|(?=[\\n);&|<>])"
                        }
                      ]
                    },
                    {
                      "name": "meta.function-call.name.fish variable.function.fish",
                      "begin": "(?!\\s)",
                      "end": "(?=[\\s);&(|<>])",
                      "patterns": [
                        {
                          "name": "meta.string.unquoted.fish",
                          "match": "\\$"
                        },
                        {
                          "include": "#string"
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "name": "invalid.illegal.function-call.fish",
              "begin": "\\%",
              "end": "(?=[\\s);&|<>])"
            },
            {
              "include": "#redirection"
            },
            {
              "begin": "(?=[^\\n\\S]+)",
              "end": "(?x)\n(?=\n  (?:\n    [\\n)#;&]\n  |\n    (?:(?:[0-9]+)?(?:<|>>?)|\\^\\^?)?\\|\n  )\n)",
              "patterns": [
                {
                  "begin": "(?!--[\\s);&|<>])",
                  "end": "(?x)\n(?=\n  (?:\n    [\\n)#;&]\n  |\n    (?:(?:[0-9]+)?(?:<|>>?)|\\^\\^?)?\\|\n  |\n    --[\\s);&|<>]\n  )\n)",
                  "patterns": [
                    {
                      "include": "#separator-whitespace"
                    },
                    {
                      "include": "#line-continuation"
                    },
                    {
                      "include": "#redirection"
                    },
                    {
                      "include": "#parameter"
                    }
                  ]
                },
                {
                  "begin": "(?=--[\\s);&|<>])",
                  "end": "(?x)\n(?=\n  (?:\n    [\\n)#;&]\n  |\n    (?:(?:[0-9]+)?(?:<|>>?)|\\^\\^?)?\\|\n  )\n)",
                  "patterns": [
                    {
                      "begin": "(?=--[\\s);&|<>])",
                      "end": "(?=[\\s);&|<>])",
                      "patterns": [
                        {
                          "include": "#parameter"
                        }
                      ]
                    },
                    {
                      "begin": "(?=\\s)",
                      "end": "(?x)\n(?=\n  (?:\n    [\\n)#;&]\n  |\n    (?:(?:[0-9]+)?(?:<|>>?)|\\^\\^?)?\\|\n  )\n)",
                      "patterns": [
                        {
                          "include": "#separator-whitespace"
                        },
                        {
                          "include": "#line-continuation"
                        },
                        {
                          "include": "#redirection"
                        },
                        {
                          "include": "#argument"
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    },
    "command-call-standard-block": {
      "patterns": [
        {
          "match": "(begin|while|if|for|switch|function)\\s*([&|<>])",
          "captures": {
            "1": {
              "name": "meta.function-call.name.fish variable.function.fish meta.string.unquoted.fish"
            },
            "2": {
              "name": "invalid.illegal.operator.fish"
            }
          }
        },
        {
          "match": "(begin)\\s*(\\))",
          "captures": {
            "1": {
              "name": "meta.function-call.name.fish variable.function.fish meta.string.unquoted.fish"
            },
            "2": {
              "name": "invalid.illegal.operator.fish"
            }
          }
        },
        {
          "name": "meta.block.begin.fish",
          "begin": "begin(?=\\s*$|\\s*[\\n;]|\\s+[^\\s-])",
          "beginCaptures": {
            "0": {
              "name": "meta.function-call.name.fish keyword.control.conditional.fish meta.string.unquoted.fish"
            }
          },
          "end": "end(?=$|[\\s);&|<>])",
          "endCaptures": {
            "0": {
              "name": "meta.function-call.name.fish keyword.control.conditional.fish meta.string.unquoted.fish"
            }
          },
          "patterns": [
            {
              "include": "$self"
            }
          ]
        },
        {
          "name": "meta.block.while.fish",
          "begin": "(?=while\\s+[^\\s)#;-])",
          "end": "end(?=$|[\\s);&|<>])",
          "endCaptures": {
            "0": {
              "name": "meta.function-call.name.fish keyword.control.conditional.fish meta.string.unquoted.fish"
            }
          },
          "patterns": [
            {
              "begin": "while",
              "beginCaptures": {
                "0": {
                  "name": "meta.function-call.name.fish keyword.control.conditional.fish meta.string.unquoted.fish"
                }
              },
              "end": "(?=[\\n);&])",
              "patterns": [
                {
                  "include": "#line-continuation"
                },
                {
                  "include": "#pipeline"
                }
              ]
            },
            {
              "begin": "(\\n)|(;)|(?=[)&])",
              "beginCaptures": {
                "1": {
                  "name": "meta.function-call.operator.control.newline.fish"
                },
                "2": {
                  "name": "meta.function-call.operator.control.semicolon.fish keyword.operator.control.fish"
                }
              },
              "end": "(?=end(?:$|[\\s);&|<>]))",
              "patterns": [
                {
                  "include": "$self"
                }
              ]
            }
          ]
        },
        {
          "name": "meta.block.if.fish",
          "begin": "(?=if\\s+[^\\s)#;-])",
          "end": "end(?=$|[\\s);&|<>])",
          "endCaptures": {
            "0": {
              "name": "meta.function-call.name.fish keyword.control.conditional.fish meta.string.unquoted.fish"
            }
          },
          "patterns": [
            {
              "include": "#command-call-standard-block-if-internal"
            }
          ]
        },
        {
          "name": "meta.block.for-in.fish",
          "begin": "(?=for\\s+[^\\s)#;-])",
          "end": "end(?=$|[\\s);&|<>])",
          "endCaptures": {
            "0": {
              "name": "meta.function-call.name.fish keyword.control.conditional.fish meta.string.unquoted.fish"
            }
          },
          "patterns": [
            {
              "begin": "(for)(\\s+)",
              "beginCaptures": {
                "1": {
                  "name": "meta.function-call.name.fish keyword.control.conditional.fish meta.string.unquoted.fish"
                },
                "2": {
                  "name": "meta.function-call.fish"
                }
              },
              "end": "\\s+",
              "endCaptures": {
                "0": {
                  "name": "meta.function-call.fish"
                }
              },
              "patterns": [
                {
                  "include": "#line-continuation"
                },
                {
                  "include": "#parameter"
                },
                {
                  "name": "invalid.illegal.operator.fish",
                  "match": "\\S+"
                }
              ]
            },
            {
              "include": "#line-continuation"
            },
            {
              "begin": "in(?=\\s)",
              "beginCaptures": {
                "0": {
                  "name": "meta.function-call.name.fish keyword.control.conditional.fish meta.string.unquoted.fish"
                }
              },
              "end": "(?=[\\n)#;&])",
              "patterns": [
                {
                  "include": "#separator-whitespace"
                },
                {
                  "include": "#line-continuation"
                },
                {
                  "include": "#argument"
                }
              ]
            },
            {
              "begin": "(\\n)|(;)|(?=[)#&])",
              "beginCaptures": {
                "1": {
                  "name": "meta.function-call.operator.control.newline.fish"
                },
                "2": {
                  "name": "meta.function-call.operator.control.semicolon.fish keyword.operator.control.fish"
                }
              },
              "end": "(?=end(?:$|[\\s);&|<>]))",
              "patterns": [
                {
                  "include": "$self"
                }
              ]
            },
            {
              "name": "invalid.illegal.function-call.fish",
              "match": "\\S+?(?=[\\s);&])"
            },
            {
              "include": "#separator-whitespace"
            }
          ]
        },
        {
          "name": "meta.block.switch.fish",
          "begin": "(?=switch\\s+[^\\s)#;-])",
          "end": "end(?=$|[\\s);&|<>])",
          "endCaptures": {
            "0": {
              "name": "meta.function-call.name.fish keyword.control.conditional.fish meta.string.unquoted.fish"
            }
          },
          "patterns": [
            {
              "begin": "(?=switch)",
              "end": "(?=[\\n);&])",
              "patterns": [
                {
                  "begin": "(switch)(\\s+)",
                  "beginCaptures": {
                    "1": {
                      "name": "meta.function-call.name.fish keyword.control.conditional.fish meta.string.unquoted.fish"
                    },
                    "2": {
                      "name": "meta.function-call.fish"
                    }
                  },
                  "end": "(?=[\\s);&])",
                  "patterns": [
                    {
                      "include": "#line-continuation"
                    },
                    {
                      "include": "#parameter"
                    },
                    {
                      "name": "invalid.illegal.operator.fish",
                      "match": "\\S+"
                    }
                  ]
                },
                {
                  "begin": "\\s+",
                  "beginCaptures": {
                    "0": {
                      "name": "meta.function-call.fish"
                    }
                  },
                  "end": "(?=[\\n);&])",
                  "patterns": [
                    {
                      "name": "invalid.illegal.string.fish",
                      "match": "\\S+?(?=[\\s);&])"
                    }
                  ]
                }
              ]
            },
            {
              "begin": "(\\n)|(;)|(?=[)&])",
              "beginCaptures": {
                "1": {
                  "name": "meta.function-call.operator.control.fish"
                },
                "2": {
                  "name": "meta.function-call.operator.control.fish keyword.operator.control.fish"
                }
              },
              "end": "(?=end(?:$|[\\s);&|<>]))",
              "patterns": [
                {
                  "begin": "case(?=[\\s);&])",
                  "beginCaptures": {
                    "0": {
                      "name": "meta.function-call.name.fish keyword.control.conditional.fish meta.string.unquoted.fish"
                    }
                  },
                  "end": "(\\n)|(;)|(?=[)#&|]|(?:[0-9]+)?(?:<|>>?)|\\^\\^?)",
                  "endCaptures": {
                    "1": {
                      "name": "meta.function-call.operator.control.newline.fish"
                    },
                    "2": {
                      "name": "meta.function-call.operator.control.semicolon.fish keyword.operator.control.fish"
                    }
                  },
                  "patterns": [
                    {
                      "include": "#separator-whitespace"
                    },
                    {
                      "include": "#line-continuation"
                    },
                    {
                      "include": "#argument"
                    }
                  ]
                },
                {
                  "include": "$self"
                }
              ]
            }
          ]
        },
        {
          "name": "meta.block.function.fish",
          "begin": "(?=function\\s+[^\\s)#;-])",
          "end": "end(?=$|[\\s);&|<>])",
          "endCaptures": {
            "0": {
              "name": "meta.function-call.name.fish keyword.control.conditional.fish meta.string.unquoted.fish"
            }
          },
          "patterns": [
            {
              "begin": "(?=function)",
              "end": "(?x)\n(?=\n  (?:\n    [\\n)#;&|]\n  |\n    (?:(?:[0-9]+)?(?:<|>>?)|\\^\\^?)\n  )\n)",
              "patterns": [
                {
                  "begin": "(function)\\s+",
                  "beginCaptures": {
                    "0": {
                      "name": "meta.function-call.name.fish"
                    },
                    "1": {
                      "name": "keyword.control.conditional.fish meta.string.unquoted.fish"
                    }
                  },
                  "end": "(?=[\\s);&|<>])",
                  "patterns": [
                    {
                      "include": "#line-continuation"
                    },
                    {
                      "name": "invalid.illegal.string.fish",
                      "begin": "[|<>]",
                      "end": "(?=[\\s);&])"
                    },
                    {
                      "begin": "(?!\\\\\\n)",
                      "end": "(?=[\\s);&|<>])",
                      "patterns": [
                        {
                          "name": "meta.function-call.parameter.argument.fish entity.name.function.fish",
                          "begin": "(?![\\s)])",
                          "end": "(?=[\\s);&|<>])",
                          "patterns": [
                            {
                              "include": "#parameter-common"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "begin": "(?=[^\\n\\S])",
                  "end": "(?x)\n(?=\n  (?:\n    [\\n)#;&|]\n  |\n    (?:(?:[0-9]+)?(?:<|>>?)|\\^\\^?)\n  )\n)",
                  "patterns": [
                    {
                      "include": "#separator-whitespace"
                    },
                    {
                      "include": "#line-continuation"
                    },
                    {
                      "include": "#parameter"
                    }
                  ]
                }
              ]
            },
            {
              "begin": "(\\n)|(;)|(?=[)#&|]|(?:[0-9]+)?(?:<|>>?)|\\^\\^?)",
              "beginCaptures": {
                "1": {
                  "name": "meta.function-call.operator.control.newline.fish"
                },
                "2": {
                  "name": "meta.function-call.operator.control.semicolon.fish keyword.operator.control.fish"
                }
              },
              "end": "(?=end(?:$|[\\s);&|<>]))",
              "patterns": [
                {
                  "include": "$self"
                }
              ]
            }
          ]
        }
      ]
    },
    "command-call-standard-block-if-internal": {
      "patterns": [
        {
          "begin": "(?=if(?:\\s*\\n|\\s+[^\\s;]))",
          "end": "(?=end(?:$|[\\s);&|<>]))",
          "patterns": [
            {
              "begin": "if",
              "beginCaptures": {
                "0": {
                  "name": "meta.function-call.name.fish keyword.control.conditional.fish meta.string.unquoted.fish"
                }
              },
              "end": "(?=[\\n#;&])",
              "patterns": [
                {
                  "include": "#line-continuation"
                },
                {
                  "include": "#pipeline"
                }
              ]
            },
            {
              "begin": "(\\n)|(;)|(?=[#&])",
              "beginCaptures": {
                "1": {
                  "name": "meta.function-call.operator.control.newline.fish"
                },
                "2": {
                  "name": "meta.function-call.operator.control.semicolon.fish keyword.operator.control.fish"
                }
              },
              "end": "(?=end(?:$|[\\s);&|<>]))",
              "patterns": [
                {
                  "begin": "(?=else\\s*[\\s;])",
                  "end": "(?=end(?:$|[\\s);&|<>]))",
                  "patterns": [
                    {
                      "begin": "else(?=\\s*[\\s;])",
                      "beginCaptures": {
                        "0": {
                          "name": "meta.function-call.name.fish keyword.control.conditional.fish meta.string.unquoted.fish"
                        }
                      },
                      "end": "(?=[\\n#;&]|if(?:\\s*\\n|\\s+[^\\s;]))",
                      "patterns": [
                        {
                          "include": "#separator-whitespace"
                        },
                        {
                          "include": "#line-continuation"
                        },
                        {
                          "name": "invalid.illegal.string.fish",
                          "match": "\\S+?(?=[\\s;&])"
                        }
                      ]
                    },
                    {
                      "begin": "(\\n)|(;)|(?=[#&])",
                      "beginCaptures": {
                        "1": {
                          "name": "meta.function-call.operator.control.newline.fish"
                        },
                        "2": {
                          "name": "meta.function-call.operator.control.semicolon.fish keyword.operator.control.fish"
                        }
                      },
                      "end": "(?=end(?:$|[\\s);&|<>]))",
                      "patterns": [
                        {
                          "include": "$self"
                        }
                      ]
                    },
                    {
                      "include": "#command-call-standard-block-if-internal"
                    }
                  ]
                },
                {
                  "include": "$self"
                }
              ]
            }
          ]
        }
      ]
    },
    "redirection": {
      "patterns": [
        {
          "begin": "(?=(?:[0-9]+(?:<|>>|>)|>>|\\^\\^|[<>^])\\&)",
          "end": "(?=[\\s);&|]|(?:[0-9]+(?:<|>>|>)|>>|\\^\\^|[<>^])(?![&<>^]))",
          "patterns": [
            {
              "begin": "(?:([0-9]+)(<|>>|>)|(>>|\\^\\^|[<>^]))(\\&)\\s*",
              "beginCaptures": {
                "0": {
                  "name": "meta.function-call.operator.redirection.fish"
                },
                "1": {
                  "name": "meta.string.unquoted.fish constant.numeric.file-descriptor.fish"
                },
                "2": {
                  "name": "keyword.operator.redirect.fish"
                },
                "3": {
                  "name": "keyword.operator.redirect.fish"
                },
                "4": {
                  "name": "keyword.operator.redirect.dereference.fish"
                }
              },
              "end": "([#&]\\S*)|(?![&\\\\])",
              "endCaptures": {
                "0": {
                  "name": "meta.function-call.operator.redirection.fish"
                },
                "1": {
                  "name": "invalid.illegal.file-descriptor.fish"
                }
              },
              "patterns": [
                {
                  "include": "#line-continuation"
                }
              ]
            },
            {
              "include": "#line-continuation"
            },
            {
              "name": "meta.function-call.operator.redirection.fish",
              "begin": "(?=\\()",
              "end": "(?!\\()",
              "patterns": [
                {
                  "include": "#command-substitution"
                }
              ]
            },
            {
              "name": "meta.function-call.operator.redirection.fish",
              "begin": "(?=\\$)",
              "end": "(?!\\$)",
              "patterns": [
                {
                  "include": "#variable-expansion"
                }
              ]
            },
            {
              "name": "meta.function-call.operator.redirection.fish",
              "begin": "(?=['\"])",
              "end": "(?!['\"])",
              "patterns": [
                {
                  "include": "#string-quoted"
                }
              ]
            },
            {
              "name": "meta.function-call.operator.redirection.file-descriptor.fish meta.string.unquoted.fish constant.numeric.file-descriptor.fish",
              "match": "(?:[0-9]+)(?=$|[\\s);&|<>])"
            },
            {
              "name": "meta.function-call.operator.redirection.file-descriptor.fish meta.string.unquoted.fish keyword.operator.redirect.close.fish",
              "match": "(?:-)(?=$|[\\s);&|<>])"
            },
            {
              "name": "meta.function-call.operator.redirection.fish invalid.illegal.file-descriptor.fish",
              "match": "(?:\\S+)"
            }
          ]
        },
        {
          "begin": "(?=(?:[0-9]+(?:<|>>|>)|>>|\\^\\^|[<>^])\\??)",
          "end": "(?=[\\s);&|]|(?:[0-9]+(?:<|>>|>)|>>|\\^\\^|[<>^])[&|])",
          "patterns": [
            {
              "begin": "(?:([0-9]+)(<|>>|>)|(>>|\\^\\^|[<>^]))(\\?)?\\s*",
              "beginCaptures": {
                "0": {
                  "name": "meta.function-call.operator.redirection.fish"
                },
                "1": {
                  "name": "meta.string.unquoted.fish constant.numeric.file-descriptor.fish"
                },
                "2": {
                  "name": "keyword.operator.redirect.fish"
                },
                "3": {
                  "name": "keyword.operator.redirect.fish"
                },
                "4": {
                  "name": "keyword.operator.redirect.clobber-test.fish"
                }
              },
              "end": "((?:[#&?]|[0-9]*[<>^])\\S*)|(?![&?<>^])",
              "endCaptures": {
                "0": {
                  "name": "meta.function-call.operator.redirection.fish"
                },
                "1": {
                  "name": "invalid.illegal.path.fish"
                }
              },
              "patterns": [
                {
                  "include": "#line-continuation"
                }
              ]
            },
            {
              "include": "#line-continuation"
            },
            {
              "name": "meta.function-call.operator.redirection.fish invalid.illegal.path.fish",
              "begin": "\\{|(?=\\})",
              "end": "[\\s);&|}]"
            },
            {
              "name": "meta.function-call.operator.redirection.fish invalid.illegal.path.fish",
              "match": "[*?]"
            },
            {
              "name": "meta.function-call.operator.redirection.fish invalid.illegal.path.fish",
              "match": "(?:[&?]|[0-9]*[<>^]).*$"
            },
            {
              "name": "meta.function-call.operator.redirection.path.fish meta.string.unquoted.fish keyword.operator.tilde.fish",
              "match": "\\~"
            },
            {
              "name": "meta.function-call.operator.redirection.path.fish",
              "begin": "(?![\\s);&(|<>${}*?])",
              "end": "(?=[\\s);&(|<>${}*?])",
              "patterns": [
                {
                  "include": "#string-quoted"
                },
                {
                  "name": "meta.string.unquoted.fish",
                  "begin": "(?![\\s);&(|<>${}*?]|['\"])",
                  "end": "(?=[\\s);&(|<>${}*?]|['\"])",
                  "patterns": [
                    {
                      "include": "#string-unquoted-contents-escapes"
                    }
                  ]
                }
              ]
            },
            {
              "name": "meta.function-call.operator.redirection.fish",
              "begin": "(?=\\()",
              "end": "(?!\\()",
              "patterns": [
                {
                  "include": "#command-substitution"
                }
              ]
            },
            {
              "name": "meta.function-call.operator.redirection.fish meta.string.unquoted",
              "begin": "(?=\\$)",
              "end": "(?!\\$)",
              "patterns": [
                {
                  "include": "#variable-expansion"
                }
              ]
            }
          ]
        }
      ]
    },
    "separator-whitespace": {
      "patterns": [
        {
          "name": "meta.function-call.fish",
          "match": "(?:[^\\n\\S]+)"
        }
      ]
    },
    "parameter": {
      "patterns": [
        {
          "begin": "(?![\\s);&|<>^])",
          "end": "(?=[\\s);&|<>])",
          "patterns": [
            {
              "name": "meta.function-call.parameter.option.end.fish variable.parameter.fish punctuation.definition.option.end.fish meta.string.unquoted.fish",
              "match": "(?:--)(?=[\\s);&|<>])"
            },
            {
              "name": "meta.function-call.parameter.option.long.fish",
              "begin": "(?=--)",
              "end": "(?=[\\s);&|<>])",
              "patterns": [
                {
                  "name": "variable.parameter.fish",
                  "begin": "(?:--)",
                  "beginCaptures": {
                    "0": {
                      "name": "punctuation.definition.option.long.begin.fish meta.string.unquoted.fish"
                    }
                  },
                  "end": "(?=[\\s);&|<>]|=)",
                  "patterns": [
                    {
                      "include": "#command-substitution"
                    },
                    {
                      "name": "meta.string.unquoted.fish",
                      "begin": "(?=\\$)",
                      "end": "(?!\\$)",
                      "patterns": [
                        {
                          "include": "#variable-expansion"
                        }
                      ]
                    },
                    {
                      "include": "#string-quoted"
                    },
                    {
                      "name": "meta.string.unquoted.fish",
                      "begin": "(?!['\"])",
                      "end": "(?=[\\s);&(|<>'\"$]|\\=)",
                      "patterns": [
                        {
                          "include": "#string-unquoted-contents"
                        }
                      ]
                    }
                  ]
                },
                {
                  "begin": "(?:=)",
                  "beginCaptures": {
                    "0": {
                      "name": "variable.parameter.fish punctuation.definition.option.long.separator.fish meta.string.unquoted.fish"
                    }
                  },
                  "end": "(?=[\\s);&|<>])",
                  "patterns": [
                    {
                      "name": "meta.string.unquoted.fish constant.numeric.fish",
                      "match": "(?:[+-]?)(?:[0-9]+\\.?[0-9]*|[0-9]*\\.?[0-9]+)(?=$|[\\s);&|<>])"
                    },
                    {
                      "include": "#parameter-common"
                    }
                  ]
                }
              ]
            },
            {
              "name": "meta.function-call.parameter.option.short.fish variable.parameter.fish",
              "begin": "(?:-)(?=[^\\s);&|<>])",
              "beginCaptures": {
                "0": {
                  "name": "punctuation.definition.option.short.fish meta.string.unquoted.fish"
                }
              },
              "end": "(?=[\\s);&|<>])",
              "patterns": [
                {
                  "include": "#parameter-common"
                }
              ]
            },
            {
              "include": "#argument"
            }
          ]
        }
      ]
    },
    "parameter-common": {
      "patterns": [
        {
          "include": "#command-substitution"
        },
        {
          "name": "meta.string.unquoted.fish",
          "begin": "(?=\\$)",
          "end": "(?!\\$)",
          "patterns": [
            {
              "include": "#variable-expansion"
            }
          ]
        },
        {
          "include": "#string"
        }
      ]
    },
    "argument": {
      "patterns": [
        {
          "begin": "(?![\\s);&|<>^])",
          "end": "(?=[\\s);&|<>])",
          "patterns": [
            {
              "name": "meta.function-call.parameter.argument.process-expansion.fish",
              "begin": "\\%",
              "beginCaptures": {
                "0": {
                  "name": "meta.string.unquoted.fish punctuation.definition.process.fish"
                }
              },
              "end": "(?=[\\s);&|<>])",
              "patterns": [
                {
                  "include": "#parameter-common"
                }
              ]
            },
            {
              "name": "meta.function-call.parameter.argument.numeric.fish meta.string.unquoted.fish constant.numeric.fish",
              "match": "(?:[+-]?)(?:[0-9]+\\.?[0-9]*|[0-9]*\\.?[0-9]+)(?=$|[\\s);&|<>])"
            },
            {
              "name": "meta.function-call.parameter.argument.path.fish",
              "begin": "(?![\\s($])",
              "end": "(?=[\\s);&|<>])",
              "patterns": [
                {
                  "name": "meta.string.unquoted.fish keyword.operator.tilde.fish",
                  "match": "\\~"
                },
                {
                  "include": "#parameter-common"
                }
              ]
            },
            {
              "name": "meta.function-call.parameter.argument.fish",
              "begin": "(?!\\s)",
              "end": "(?=[\\s);&|<>])",
              "patterns": [
                {
                  "include": "#parameter-common"
                }
              ]
            }
          ]
        }
      ]
    },
    "command-substitution": {
      "patterns": [
        {
          "begin": "(?=\\()",
          "end": "(?![\\(\\[])",
          "patterns": [
            {
              "name": "meta.parens.command-substitution.fish",
              "begin": "\\(",
              "beginCaptures": {
                "0": {
                  "name": "punctuation.section.parens.begin.fish"
                }
              },
              "end": "\\)",
              "endCaptures": {
                "0": {
                  "name": "punctuation.section.parens.end.fish"
                }
              },
              "patterns": [
                {
                  "include": "$self"
                }
              ]
            },
            {
              "include": "#index-expansion"
            }
          ]
        }
      ]
    },
    "variable-expansion": {
      "patterns": [
        {
          "include": "#variable-expansion-illegal"
        },
        {
          "include": "#variable-builtin"
        },
        {
          "name": "meta.variable-expansion.fish",
          "begin": "(?=\\$)",
          "end": "(?=[^\\$\\[])",
          "patterns": [
            {
              "include": "#variable-expansion-simple"
            },
            {
              "include": "#index-expansion"
            }
          ]
        }
      ]
    },
    "variable-expansion-simple": {
      "patterns": [
        {
          "name": "variable.other.fish",
          "begin": "\\$",
          "beginCaptures": {
            "0": {
              "name": "punctuation.definition.variable.fish"
            }
          },
          "end": "(?=[^\\$\\w])(?!\\\\\\n)",
          "patterns": [
            {
              "include": "#string-unquoted-contents-escapes-newline"
            },
            {
              "include": "#variable-expansion-illegal"
            },
            {
              "include": "#variable-expansion-simple"
            }
          ]
        }
      ]
    },
    "variable-expansion-illegal": {
      "patterns": [
        {
          "name": "invalid.illegal.variable-expansion.fish",
          "match": "\\$(?:(?=[,'\"\\]}\\s);&|])|[^\\w\\$][^$,'\"\\]}\\s);&|]*)"
        }
      ]
    },
    "variable-builtin": {
      "patterns": [
        {
          "name": "variable.language.fish",
          "match": "(\\$)(PATH|CDPATH|FISH_DEBUG|FISH_DEBUG_OUTPUT|LANG|LC_(ALL|COLLATE|CTYPE|MESSAGES|MONETARY|NUMERIC)|fish_color_(normal|command|keyword|quote|redirection|end|error|param|valid_path|option|comment|selection|operator|escape|autosuggestion|cwd|cwd_root|user|host|host_remote|status|cancel|search_match)|fish_ambiguous_width|fish_emoji_width|fish_autosuggestion_enabled|fish_handle_reflow|fish_key_bindings|fish_escape_delay_ms|fish_greeting|fish_history|fish_trace|fish_user_paths|umask|BROWSER|_|argv|CMD_DURATION|COLUMNS|LINES|fish_kill_signal|fish_killring|fish_pid|history|HOME|hostname|IFS|last_pid|PWD|pipestatus|SHLVL|status|status_generation|USER|EUID|version|FISH_VERSION|__fish_bin_dir|__fish_config_dir|__fish_data_dir|__fish_help_dir|__fish_sysconf_dir|__fish_user_data_dir)\\b",
          "captures": {
            "1": {
              "name": "punctuation.definition.variable.fish"
            }
          }
        }
      ]
    },
    "index-expansion": {
      "patterns": [
        {
          "name": "meta.brackets.index-expansion.fish",
          "begin": "\\[",
          "beginCaptures": {
            "0": {
              "name": "punctuation.section.brackets.begin.fish"
            }
          },
          "end": "\\]",
          "endCaptures": {
            "0": {
              "name": "punctuation.section.brackets.end.fish"
            }
          },
          "patterns": [
            {
              "name": "keyword.operator.range.fish",
              "match": "\\.\\."
            },
            {
              "include": "#command-substitution"
            },
            {
              "include": "#variable-expansion"
            },
            {
              "include": "#string-quoted"
            },
            {
              "name": "constant.numeric.fish",
              "match": "(?:[+-]?[0-9]+)(?=[\\s);&|<>]|\\]|\\.\\.)"
            },
            {
              "name": "invalid.illegal.index.fish",
              "match": "\\S"
            }
          ]
        }
      ]
    },
    "string": {
      "patterns": [
        {
          "include": "#string-quoted"
        },
        {
          "include": "#string-unquoted"
        }
      ]
    },
    "string-quoted": {
      "patterns": [
        {
          "name": "string.quoted.single.fish",
          "begin": "\\'",
          "beginCaptures": {
            "0": {
              "name": "punctuation.definition.string.begin.fish"
            }
          },
          "end": "\\'",
          "endCaptures": {
            "0": {
              "name": "punctuation.definition.string.end.fish"
            }
          },
          "patterns": [
            {
              "name": "constant.character.escape.fish",
              "match": "\\\\[\\'\\\\]"
            }
          ]
        },
        {
          "name": "string.quoted.double.fish",
          "begin": "\\\"",
          "beginCaptures": {
            "0": {
              "name": "punctuation.definition.string.begin.fish"
            }
          },
          "end": "\\\"",
          "endCaptures": {
            "0": {
              "name": "punctuation.definition.string.end.fish"
            }
          },
          "patterns": [
            {
              "include": "#string-quoted-contents"
            }
          ]
        }
      ]
    },
    "string-quoted-contents": {
      "patterns": [
        {
          "name": "constant.character.escape.fish",
          "match": "\\\\[\\n\\\"\\\\$]"
        },
        {
          "include": "#variable-expansion"
        }
      ]
    },
    "string-unquoted": {
      "patterns": [
        {
          "name": "meta.string.unquoted.fish",
          "begin": "(?![\\s);&(|<>'\"$])",
          "end": "(?=[\\s);&(|<>'\"$])",
          "patterns": [
            {
              "include": "#string-unquoted-contents"
            }
          ]
        }
      ]
    },
    "string-unquoted-contents": {
      "patterns": [
        {
          "include": "#string-unquoted-contents-escapes"
        },
        {
          "name": "meta.braces.brace-expansion.fish",
          "begin": "\\{",
          "beginCaptures": {
            "0": {
              "name": "punctuation.section.braces.begin.fish"
            }
          },
          "end": "(\\})|(\\n|[;&)|].*)",
          "endCaptures": {
            "1": {
              "name": "punctuation.section.braces.end.fish"
            },
            "2": {
              "name": "invalid.illegal.punctuation.section.fish"
            }
          },
          "patterns": [
            {
              "name": "punctuation.section.braces.separator.fish",
              "match": "\\,"
            },
            {
              "include": "#command-substitution"
            },
            {
              "include": "#variable-expansion"
            },
            {
              "name": "invalid.illegal.whitespace.fish",
              "match": "(?:[^\\n\\S]+)"
            },
            {
              "include": "#string-quoted"
            },
            {
              "name": "constant.numeric.fish",
              "match": "(?:[+-]?)(?:[0-9]+\\.?[0-9]*|[0-9]*\\.?[0-9]+)(?=$|[\\s);&|<>]|\\}|\\,)"
            },
            {
              "begin": "(?![\\s);&|<>'\"])",
              "end": "(?=[\\s);&|<>'\"]|\\}|\\,)",
              "patterns": [
                {
                  "name": "constant.character.escape.fish",
                  "match": "\\\\\\,"
                },
                {
                  "include": "#string-unquoted-contents"
                }
              ]
            }
          ]
        },
        {
          "name": "meta.wildcard-expansion.fish",
          "match": "(\\*\\*)|(\\*)|(\\?)",
          "captures": {
            "1": {
              "name": "keyword.operator.double-star.fish"
            },
            "2": {
              "name": "keyword.operator.single-star.fish"
            },
            "3": {
              "name": "keyword.operator.question-mark.fish"
            }
          }
        }
      ]
    },
    "string-unquoted-contents-escapes": {
      "patterns": [
        {
          "name": "constant.character.escape.fish",
          "match": "(?x)\n\\\\[abefnrtv $\\\\*?#(){}\\[\\]<>^&|;\"']\n|\n\\\\[~%]\n|\n\\\\[xX][0-9A-Fa-f]{1,2}\n|\n\\\\[0-7]{1,3}\n|\n\\\\u[0-9A-Fa-f]{1,4}\n|\n\\\\U[0-9A-Fa-f]{1,8}\n|\n\\\\c[?-~]"
        },
        {
          "include": "#string-unquoted-contents-escapes-newline"
        }
      ]
    },
    "string-unquoted-contents-escapes-newline": {
      "patterns": [
        {
          "name": "constant.character.escape.newline.fish",
          "match": "\\\\\\n"
        }
      ]
    }
  }
}
